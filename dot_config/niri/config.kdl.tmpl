// Generated by Chezmoi
// Profile: {{ .profile }}
// Note: Template updated to use `.hardware` and accept `orientation` or `transform` keys

// === Display Configuration ===
{{- $profile := .profile -}}
{{- if hasKey . "hardware" -}}
    {{- $hardware := index .hardware $profile -}}
    {{- if and $hardware $hardware.monitors -}}
        {{- range $hardware.monitors }}
output "{{ .name }}" {
    scale {{ .scale }}
    {{- if hasKey . "mode" }}
    mode "{{ .mode }}"
    {{- end }}
    {{- if hasKey . "position" }}
    position {{ .position }}
    {{- end }}
    {{- if hasKey . "orientation" }}
    transform "{{ .orientation }}"
    {{- else if hasKey . "transform" }}
    transform "{{ .transform }}"
    {{- end }}
}
        {{- end }}
    {{- end }}
{{- else -}}
    {{- $hardware := index . $profile -}}
    {{- if and $hardware $hardware.monitors -}}
        {{- range $hardware.monitors }}
output "{{ .name }}" {
    scale {{ .scale }}
    {{- if hasKey . "mode" }}
    mode "{{ .mode }}"
    {{- end }}
    {{- if hasKey . "position" }}
    position {{ .position }}
    {{- end }}
    {{- if hasKey . "orientation" }}
    transform "{{ .orientation }}"
    {{- else if hasKey . "transform" }}
    transform "{{ .transform }}"
    {{- end }}
}
        {{- end }}
    {{- end }}
{{- end }}

// === Input & General Settings ===
config-notification {
    disable-failed
}

gestures {
    hot-corners {
        top-left
    }
}

input {
    keyboard {
        xkb {}
        numlock
    }
    touchpad {
        tap
        natural-scroll 
        accel-profile "adaptive"
        accel-speed 0.1
    }
    mouse {}
    trackpoint {}
}

prefer-no-csd
screenshot-path "~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"

// === Layout & Visuals ===
layout {
    // Positioning
    // Positioning (gaps are in dms/layout.kdl)


    center-focused-column "always"
    preset-column-widths {
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
    }
    default-column-width { proportion 0.9; }

    // Visuals (Colors are imported)
    background-color "transparent"

    // Border & focus width are in dms/layout.kdl


    shadow {
        softness 30
        spread 5
        offset x=0 y=5
    }

    tab-indicator {
    }

    struts {}
}

// === Animations ===
animations {
    workspace-switch {
        spring damping-ratio=0.80 stiffness=523 epsilon=0.0001
    }
    window-open {
        duration-ms 150
        curve "ease-out-expo"
    }
    window-close {
        duration-ms 150
        curve "ease-out-quad"
    }
    horizontal-view-movement {
        spring damping-ratio=0.85 stiffness=423 epsilon=0.0001
    }
    window-movement {
        spring damping-ratio=0.75 stiffness=323 epsilon=0.0001
    }
    window-resize {
        spring damping-ratio=0.85 stiffness=423 epsilon=0.0001
    }
    config-notification-open-close {
        spring damping-ratio=0.65 stiffness=923 epsilon=0.001
    }
    screenshot-ui-open {
        duration-ms 200
        curve "ease-out-quad"
    }
    overview-open-close {
        spring damping-ratio=0.85 stiffness=800 epsilon=0.0001
    }
}

// === Window Rules ===
// WezTerm
window-rule {
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    default-column-width {}
    draw-border-with-background false
}

// Nautilus
window-rule {
    match app-id=r#"^nautilus$"#
    match app-id=r#"^org\.gnome\.Nautilus(\.desktop)?$"#
    open-floating true
}

// Gnome Apps
window-rule {
    match app-id=r#"^org\.gnome\."#
    draw-border-with-background false
    geometry-corner-radius 12
    clip-to-geometry true
}

// Floating Dialogs
window-rule {
    match app-id=r#"^gnome-control-center$"#
    match app-id=r#"^pavucontrol$"#
    match app-id=r#"^nm-connection-editor$"#
    default-column-width { proportion 0.5; }
    open-floating false
}

// Terminals without borders
window-rule {
    match app-id="Alacritty"
    match app-id="zen"
    match app-id="com.mitchellh.ghostty"
    match app-id="kitty"
    draw-border-with-background false
}

// Inactive opacity
window-rule {
    match is-active=false
    opacity 0.9
}

// PiP / floating utils
window-rule {
    match app-id=r#"firefox$"# title="^Picture-in-Picture$"
    match app-id="zoom"
    open-floating true
}

// QuickShell
window-rule {
    match app-id=r#"org.quickshell$"#
    open-floating true
}



// === Layer Rules ===
layer-rule {
    match namespace="^quickshell$"
    place-within-backdrop true
}

include "./dms/wpblur.kdl"

// === Overview & Overlays ===
overview {
    workspace-shadow {
        off
    }
}

hotkey-overlay {
    skip-at-startup
}

include "./dms/alttab.kdl"

// === Autostart & Environment ===
spawn-at-startup "dbus-update-activation-environment" "--systemd" "DISPLAY" "WAYLAND_DISPLAY" "SWAYSOCK" "XDG_CURRENT_DESKTOP" "XDG_SESSION_TYPE" "NIRI_SOCKET" "SSH_AUTH_SOCK" "GNOME_KEYRING_CONTROL"
spawn-at-startup "bash" "-c" "wl-paste --watch cliphist store &"
spawn-at-startup "obsidian"

environment {
  XDG_CURRENT_DESKTOP "niri"
  DEFAULT_FILE_EXPLORER "nautilus"
  DEFAULT_FILE_PICKER "nautilus"
}

debug {
    honor-xdg-activation-with-invalid-serial
}

// === Binds ===
include "./dms/binds.kdl"

include "./dms/colors.kdl"
include "./dms/layout.kdl"
